{% load static %}
<!doctype html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/x-icon" href="{% static 'img/favicon.png' %}">
  <title>{% block title %}{{ PROGRAM.name }}{% endblock %}</title>

  <!-- Tailwind (CDN) + paleta -->
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: '#0f7a4a',
            brandDark: '#0b5e39',
            teal: '#2ca67a',
            mint: '#b5ebcf',
            accent: '#f59e0b',
            ink: '#0f172a',
          },
          boxShadow: { soft: '0 12px 32px rgba(0,0,0,.08)' }
        }
      }
    }
  </script>

  <style type="text/tailwindcss">
    @layer components {
      .btn { @apply inline-flex items-center justify-center rounded-md px-4 py-2 text-sm font-medium transition focus:outline-none focus:ring-2 focus:ring-offset-2; }
      .btn-primary { @apply bg-brand text-white hover:bg-brandDark focus:ring-brand; }
      .btn-outline { @apply border border-brand text-brand hover:bg-mint/30 focus:ring-brand; }
      .btn-ghost { @apply text-brand hover:text-brandDark; }
      .link { @apply text-brand hover:text-brandDark hover:underline; }
      .input { @apply block w-full rounded-md border-gray-300 shadow-sm focus:border-brand focus:ring-brand; }
      .pill { @apply rounded-full; }
    }
  </style>

  <!-- HTMX + extensiones -->
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>
  <script src="https://unpkg.com/htmx.org/dist/ext/disable-element.js"></script>
  <!-- Iconos -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    .show-while-loading {
      display: none;
    }

    .htmx-request .show-while-loading {
      display: inline-block;
    }

    .htmx-request .hide-while-loading {
      display: none;
    }

    .htmx-indicator {
      display: none;
    }

    .htmx-request .htmx-indicator {
      display: grid;
    }

    [aria-busy="true"] .btn-label {
      opacity: 0;
    }

    button:disabled {
      cursor: not-allowed;
      opacity: .6;
    }
  </style>

  <script>
    // cursor global
    document.addEventListener('htmx:send', () => document.body.classList.add('cursor-wait'));
    const off = () => document.body.classList.remove('cursor-wait');
    document.addEventListener('htmx:afterOnLoad', off);
    document.addEventListener('htmx:responseError', off);

    // render icons al cargar
    document.addEventListener('DOMContentLoaded', () => {
      if (window.lucide) window.lucide.createIcons();
    });
    // y despuÃ©s de swaps HTMX
    document.addEventListener('htmx:afterSwap', () => {
      if (window.lucide) window.lucide.createIcons();
    });
  </script>
  {% block extra_head %}{% endblock %}
</head>

<body class="bg-gray-50 text-ink min-h-screen flex flex-col">

  {# ====== TOPBAR (acciones del portal) ====== #}
  <header class="bg-white border-b">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between gap-4">
      <div class="flex items-center gap-3">
        <a href="/" class="text-lg font-semibold tracking-tight text-gray-900">
          AlimentaTec
        </a>
        {# aquÃ­ podemos poner breadcrumb global despuÃ©s #}
      </div>

      {% if request.user.is_authenticated %}
      <nav class="flex items-center gap-3">
        {# esto es del PORTAL, no de las apps #}

        <span class="hidden sm:inline text-sm text-gray-600">
          Bienvenido {{ request.user.get_full_name|default:request.user.username }}
        </span>
        <form action="{% url 'logout' %}" method="post">
          {% csrf_token %}
          <button type="submit"
            class="inline-flex items-center rounded-lg px-3 py-1.5 text-sm bg-gray-100 text-gray-700 hover:bg-gray-200">
            Cerrar sesiÃ³n
          </button>
        </form>

        {% if request.user.is_staff %}
        <a href="/admin/"
          class="inline-flex items-center gap-1 rounded-lg px-3 py-1.5 text-sm bg-gray-900 text-white hover:bg-black">
          <i data-lucide="settings" class="w-4 h-4"></i>
          Admin
        </a>
        {% endif %}
      </nav>
      {% else %}
      <a href="{% url 'login' %}"
        class="inline-flex items-center rounded-lg px-3 py-2 text-sm bg-green-700 text-white hover:bg-green-800">
        Login
      </a>
      {% endif %}
    </div>
  </header>

  <div class="flex flex-1 min-h-0">
    {# ====== SIDEBAR (aplicaciones) ====== #}
    <aside class="w-64 bg-white border-r hidden md:block">
      <div class="py-4">
        <p class="px-4 text-xs uppercase tracking-wide text-gray-400 mb-3">
          Aplicaciones
        </p>
        <nav class="space-y-1 text-sm">

          {# 1. Companies (esta sÃ­ existe) #}
          <a href="{% url 'core:company_list' %}" class="flex items-center gap-2 px-4 py-2 hover:bg-gray-100
             {% if request.resolver_match.url_name == 'company_list' %}bg-gray-100 text-gray-900{% endif %}">
            <i data-lucide="building-2" class="w-4 h-4 text-gray-400"></i>
            Companies
          </a>

        </nav>
      </div>
    </aside>

    {# ====== CONTENIDO ====== #}
    <main class="flex-1 min-w-0">
      <div class="max-w-7xl mx-auto px-4 py-6">
        {% if messages %}
        <div class="mb-4 space-y-2">
          {% for m in messages %}
          <div class="rounded px-3 py-2 border
                        {% if 'error' in m.tags %}
                          border-red-300 bg-red-50 text-red-800
                        {% else %}
                          border-emerald-300 bg-mint/50 text-brandDark
                        {% endif %}">
            {{ m }}
          </div>
          {% endfor %}
        </div>
        {% endif %}

        {% block content %}{% endblock %}
      </div>
    </main>
  </div>

  {# ====== FOOTER corporativo (igual al tuyo) ====== #}
  <footer class="mt-12">
    <section class="bg-gradient-to-r from-brand to-teal text-white">
      <div class="max-w-6xl mx-auto px-4 py-6 grid sm:grid-cols-2 gap-6 items-center">
        <div>
          <h3 class="text-lg font-semibold">MÃ¡s informaciÃ³n</h3>
          <p class="opacity-90 text-sm">EscrÃ­benos y con gusto te atenderemos.</p>
        </div>
        <div class="flex flex-wrap gap-4 text-sm">
          {% if PROGRAM.phone %}
          <span class="inline-flex items-center gap-2 rounded-full bg-white/10 px-3 py-1">
            <span>ðŸ“ž</span><span>{{ PROGRAM.phone }}</span>
          </span>
          {% endif %}
          {% if PROGRAM.email %}
          <a class="inline-flex items-center gap-2 rounded-full bg-white/10 px-3 py-1 hover:bg-white/20"
            href="mailto:{{ PROGRAM.email }}">
            <span>âœ‰</span><span>{{ PROGRAM.email }}</span>
          </a>
          {% endif %}
        </div>
      </div>
    </section>

    <section class="bg-white">
      <div class="max-w-6xl mx-auto px-4 py-6 flex flex-wrap items-center justify-between gap-6">
        <div class="flex items-center gap-3">
          <img src="{% static 'img/logo-cib.png' %}" class="h-10" alt="CIB" onerror="this.style.display='none'">
          <img src="{% static 'img/logo-gob-antioquia.png' %}" class="h-10" alt="GobernaciÃ³n de Antioquia"
            onerror="this.style.display='none'">
        </div>
        <p class="text-xs text-gray-500">Â© {{ PROGRAM.name }} â€” {{ now|date:"Y" }}</p>
      </div>
    </section>
  </footer>

  <div id="modal">
    <div id="modal-overlay" class="hidden fixed inset-0 bg-black/30"></div>
  </div>
  <div id="modal-indicator" class="hidden">Cargando ...</div>

  {% block extra_js %}{% endblock %}
</body>

</html>